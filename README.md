# TBSchedule学习
源码解读：[http://defworld.com/2016/09/14/tbschedule-source-code-analysis/][1]

[1]:	http://defworld.com/2016/09/14/tbschedule-source-code-analysis/



# TBSchedule扫盲
## 一、什么是TBSchedule
  **TBSchedule是一款非常优秀的高性能分布式调度框架**，同类应用有Spring Task、Quartz。
(img)
图1.1 TBSchedule关键字
(img)
图1.2 TBSchedule外部形态
  从TBSchedule的内部形态来说，与他有关的关键词包括批量任务、动态扩展、多主机、多线程、并发、分片……，这些词看起来非常的高大上，都是时下互联网技术比较流行的词汇。从TBSchedule的外部架构来看，一目了然，宿主在调度应用中与ZooKeeper进行通信。一个框架结构是否是优秀的，从美感的角度就可以看出来，一个好的架构一定是隐藏了内部复杂的原理，外部视觉上美好的，让用户使用起来简单易懂。

 ## 二、为什么要用TBSchedule
  时下互联网和电商领域，各个平台都存在大数据、高并发的特点，对数据处理的要求越来越高，既要保证高效性，又要保证安全性、准确性。TBSchedule的使命就是将调度作业从业务系统中分离出来，降低或者是消除和业务系统的耦合度，进行高效异步任务处理。其实在互联网和电商领域TBSchedule的使用非常广泛，目前被应用于阿里巴巴、淘宝、支付宝、京东、聚美、汽车之家、国美等很多互联网企业的流程调度系统。
1. 传统的调度框架spring task、quartz也是可以进行集群调度作业的，一个节点挂了可以将任务漂移给其他节点执行从而避免单点故障，但是不支持分布式作业，一旦达到单机处理极限也会存在问题。
2. elastic-job支持分布式，是一个很好的调度框架，但是开源时间较短，还没有经历大范围市场考验。
3. Beanstalkd基于C语言开发，使用范围较小，无法引入到php、java系统平台。
## 三、有什么优势、缺陷
### 优势：
	1. 支持集群、分布式
	2. 灵活的任务分片
	3. 动态的服务扩容和资源回收
	4. 任务监控支持
	5. 经历了多年市场考验，阿里强大技术团队支持
~~TBSchedule支持Cluster，可以宿主在多台服务器多个线程组并行进行任务调度，或者说可以将一个大的任务拆成多个小任务分配到不同的服务器。
~~
~~TBSchedule的分布式机制是通过灵活的Sharding方式实现的，比如可以按所有数据的ID按10取模分片（分片规则如图2.1）、按月份分片等等，根据不同的需求，不同的场景由客户端配置分片规则。然后就是TBSchedule的宿主服务器可以进行动态扩容和资源回收，这个特点主要是因为它后端依赖的ZooKeeper，这里的ZooKeeper对于TBSchedule来说是一个NoSQL，用于存储策略、任务、心跳信息数据，它的数据结构类似文件系统的目录结构，它的节点有临时节点、持久节点之分。调度引擎上线后，随着业务量数据量的增多，当前Cluster可能不能满足目前的处理需求，那么就需要增加服务器数量，一个新的服务器上线后会在ZooKeeper中创建一个代表当前服务器的一个唯一性路径（临时节点），并且新上线的服务器会和ZooKeeper保持长连接，当通信断开后，节点会自动摘除。
~~
~~TBSchedule会定时扫描当前服务器的数量，重新进行任务分配。TBSchedule不仅提供了服务端的高性能调度服务，还提供了一个scheduleConsole war随着宿主应用的部署直接部署到服务器，可以通过web的方式对调度的任务、策略进行监控管理，以及实时更新调整。

(img)
图3.1 TBSchedule分片规则


### 缺陷 & 挑战
	1. 目前ScheduleConsole监控页面过于简单，需完善UI设计，提高用户体验
	2. 支持Zookeeper集群自动切换，避免ZooKeeper服务的集群单点故障。
	3. 原生ZooKeeper操作替换为Curator，Curator对ZooKeeper进行了一次包装，对原生ZooKeeper的操作做了大量优化，Client和Server之间的连接可能出现的问题处理等等，可以进一步提高TBSchedule的高可用。
	4. TBSchedule的帮助文档较少，网上的资料基本是千篇一律，希望有更多的爱好者加入进来。

原文链接： [[http://geek.csdn.net/news/detail/65738]]